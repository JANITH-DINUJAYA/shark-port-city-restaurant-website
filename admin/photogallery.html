<!doctype html>
<html lang="en">
<head>
    <title>Shark Port City</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://kit.fontawesome.com/1165876da6.js" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet"/>
    <style>
        :root {
            --primary-dark: #2c3e50;
            --secondary-light: #f4f7f6;
            --text-color: #333;
            --white: #ffffff;
            --accent-green: #2ecc71;
            --accent-blue: #3498db;
            --accent-purple: #9b59b6;
            --accent-orange: #f39c12;
            --online-status: #34c759;
        }
        body {
            background-color: var(--secondary-light);
            color: var(--text-color);
            margin: 0;
            font-family: 'Poppins', sans-serif;
            display: flex;
            min-height: 100vh;
        }
        .main-content { flex-grow: 1; padding: 50px; display: flex; flex-direction: column; gap: 40px; }
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .back-button {
            background-color: var(--primary-dark);
            color: var(--white);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            transition: background-color 0.3s ease;
        }
        .back-button:hover { background-color: #34495e; }
        nav {
            background-color: #000000;
            width: 350px;
            padding: 30px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            position: sticky;
            top:0;
            left:0;
            height: 100vh;
        }
        .logo { margin-bottom: 20px; }
        .logo img { width: 150px; }
        .profile-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            margin-bottom: 20px;
            color: var(--white);
        }
        .online-indicator {
            width: 10px;
            height: 10px;
            background-color: var(--online-status);
            border-radius: 50%;
            animation: pulse-online 1.5s infinite;
        }
        @keyframes pulse-online {
            0% { box-shadow: 0 0 0 0 rgba(52,199,89,0.7); }
            70% { box-shadow: 0 0 0 10px rgba(52,199,89,0); }
            100% { box-shadow: 0 0 0 0 rgba(52,199,89,0); }
        }
        nav ul { list-style:none; padding:0; width:100%; margin:0; }
        nav ul li { position: relative; }
        nav ul li a {
            display:block;
            padding:20px 30px;
            color: var(--white);
            text-decoration:none;
            font-size:16px;
            transition: background-color 0.3s ease, padding-left 0.3s ease;
            cursor:pointer;
        }
        nav ul li a:hover {
            background-color: rgba(255,255,255,0.1);
            padding-left: 40px;
            text-decoration: underline solid #f70404;
            text-decoration-thickness:3px;
        }
        .dropdown-content {
            display:none;
            position:absolute;
            top:100%;
            left:0;
            background-color:#000;
            width:100%;
            box-shadow:0 8px 16px rgba(0,0,0,0.2);
            z-index:100;
            border-radius:0 0 8px 8px;
        }
        .dropdown:hover .dropdown-content { display:block; }
        .dropdown-content li a:hover { background-color:#1a1a1a; padding-left:45px; }
        @media (max-width:992px) { .main-content { padding:20px; } }
        .gallery-container { background: var(--white); border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.05); padding:30px; }
        .gallery-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
        .gallery-header h2 { color: var(--primary-dark); font-weight:600; }
        .btn-primary { background-color: #f70404; border:none; font-weight:600; transition: background-color 0.3s ease; }
        .btn-primary:hover { background-color:#f70404; }
        .image-card {
            position: relative; overflow:hidden; border-radius:8px;
            box-shadow:0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .image-card:hover { transform: translateY(-5px); box-shadow:0 4px 15px rgba(0,0,0,0.15); }
        .image-card img { width:100%; height:200px; object-fit:cover; display:block; }
        .image-actions {
            position:absolute; bottom:0; left:0; right:0; background:rgba(0,0,0,0.6);
            padding:10px; display:flex; justify-content:center; gap:10px; opacity:0;
            transition: opacity 0.3s ease;
        }
        .image-card:hover .image-actions { opacity:1; }
        .image-actions .btn {
            background-color:transparent; border:1px solid var(--white);
            color: var(--white); font-size:14px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .image-actions .btn:hover { background-color:var(--white); color: var(--primary-dark); }
        #photo-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(250px,1fr)); gap:20px; margin-top:20px; }
    </style>
</head>
<body>
<nav>
    <div class="logo"><img src="../images/Group 17.png" alt="Shark Port City Logo"/></div>
    <div class="profile-status"><span class="online-indicator"></span> Online</div>
    <ul>
        <li><a href="home.php">Dashboard</a></li>
        <li class="dropdown"><a href="#">User Management ▾</a>
            <ul class="dropdown-content">
                <li><a href="customer.html">Customer</a></li>
                <li><a href="partner.html">Delivery Partners</a></li>
                <li><a href="staff.html">Staff</a></li>
            </ul>
        </li>
        <li class="dropdown"><a href="#">Content Management ▾</a>
            <ul class="dropdown-content">
                <li><a href="banners.html">Banners</a></li>
                <li><a href="photogallery.html">Photo Galleries</a></li>
            </ul>
        </li>
        <li class="dropdown"><a href="#">Dish Management ▾</a>
            <ul class="dropdown-content">
                <li><a href="Menumanage.php">Menus</a></li>
                <li><a href="promotionmanagement.php">Promotions</a></li>
            </ul>
        </li>
        <li class="dropdown"><a href="#">Order & Reservation Management ▾</a>
            <ul class="dropdown-content">
                <li><a href="ordermanage.html">Orders</a></li>
                <li><a href="reservationmanage.html">Reservations</a></li>
            </ul>
        </li>
        <li><a href="inquiries.html">Inquiries</a></li>
        <li><a href="send-email.php">Notifications</a></li>
        <li><a href="login.html">Log Out</a></li>
    </ul>
</nav>

<div class="main-content">
    <div class="header-bar">
        <h2>Photo Gallery Management</h2>
        <a href="home.php" class="back-button">Back to Dashboard</a>
    </div>
    <hr/>
    <div class="gallery-container">
        <div class="gallery-header">
            <h2>Current Photos</h2>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadPhotoModal">
                <i class="fas fa-upload me-2"></i>Upload New Photo
            </button>
        </div>
        <div id="photo-grid"></div>
    </div>
</div>

<div class="modal fade" id="uploadPhotoModal" tabindex="-1" aria-labelledby="uploadPhotoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="uploadPhotoModalLabel">Upload New Photo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="uploadPhotoForm">
                    <div class="mb-3">
                        <label for="photoFile" class="form-label">Select Image File</label>
                        <input class="form-control" type="file" id="photoFile" accept="image/*" required/>
                    </div>
                    <div class="mb-3">
                        <label for="photoCaption" class="form-label">Image Caption (Optional)</label>
                        <input type="text" class="form-control" id="photoCaption" placeholder="e.g., Delicious seafood platter"/>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Upload Photo</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const uploadForm = document.getElementById('uploadPhotoForm');
    const photoGrid = document.getElementById('photo-grid');
    const firebaseUrl = 'https://shark-port-city-default-rtdb.asia-southeast1.firebasedatabase.app/photos.json';
    const imgbbApiKey = 'bbfda5a6eaea6c85b9c3125b4c8cc463';

    function renderPhotoCard(id, url, caption) {
        const card = document.createElement('div');
        card.classList.add('image-card');
        card.dataset.id = id;
        card.innerHTML = `
            <img src="${url}" alt="${caption || 'Photo'}" />
            <div class="image-actions">
                <button class="btn btn-sm delete-photo-btn">Delete</button>
            </div>
        `;
        photoGrid.appendChild(card);
    }

    async function loadPhotos() {
        photoGrid.innerHTML = '';
        try {
            const res = await fetch(firebaseUrl);
            const data = await res.json();
            if (data) {
                Object.keys(data).forEach(id => {
                    renderPhotoCard(id, data[id].url, data[id].caption);
                });
            }
        } catch (err) {
            console.error('Failed to load photos', err);
        }
    }

    uploadForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const fileInput = document.getElementById('photoFile');
        const captionInput = document.getElementById('photoCaption');
        const file = fileInput.files[0];
        if (!file) return alert('Please select a file');

        const formData = new FormData();
        formData.append('image', file);

        try {
            const imgbbRes = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbApiKey}`, {
                method: 'POST',
                body: formData
            });
            const imgbbData = await imgbbRes.json();
            if (!imgbbData.success) throw new Error('ImgBB upload failed');
            const imageUrl = imgbbData.data.url;

            // Save to Firebase
            const fbRes = await fetch(firebaseUrl, {
                method: 'POST',
                body: JSON.stringify({ url: imageUrl, caption: captionInput.value }),
                headers: { 'Content-Type': 'application/json' }
            });
            if (!fbRes.ok) throw new Error('Failed to save image to Firebase');

            bootstrap.Modal.getInstance(document.getElementById('uploadPhotoModal')).hide();
            uploadForm.reset();
            loadPhotos();
            alert('Photo uploaded successfully!');
        } catch (err) {
            console.error(err);
            alert('Upload failed: ' + err.message);
        }
    });

    photoGrid.addEventListener('click', async (e) => {
        if (!e.target.classList.contains('delete-photo-btn')) return;
        const card = e.target.closest('.image-card');
        const id = card.dataset.id;
        if (!confirm('Are you sure you want to delete this photo?')) return;

        try {
            const delRes = await fetch(`https://shark-port-city-default-rtdb.asia-southeast1.firebasedatabase.app/photos/${id}.json`, {
                method: 'DELETE'
            });
            if (!delRes.ok) throw new Error('Failed to delete photo');
            loadPhotos();
            alert('Photo deleted successfully!');
        } catch (err) {
            console.error(err);
            alert('Delete failed: ' + err.message);
        }
    });

    loadPhotos();
});
</script>
</body>
</html>
